#!/bin/bash

# Vérifiez si un argument a été fourni
if [ "$#" -ne 1 ]; then
    echo "Usage: $0 "
    exit 1
fi

# Assignez l'argument fourni à une variable
SNAPSHOT_FILE_NAME=$1

# Utilisez la variable dans la commande
ETCDCTL_API=3 etcdctl --data-dir="/var/lib/etcd/" \
--endpoints=https://{{ ansible_default_ipv4.address ipv4_address_eth0.stdout }}:2379 \
--name={{ansible_hostname ipv4_address_eth0.stdout }} \
--cacert=/etc/kubernetes/pki/etcd/ca.crt \
--cert=/etc/kubernetes/pki/etcd/server.crt \
--key=/etc/kubernetes/pki/etcd/server.key \
--initial-advertise-peer-urls=https://{{ansible_default_ipv4.addressipv4_address_eth0.stdout }}:2380 \
--initial-cluster-token=etcd-cluster-0 \
--initial-cluster=devk8sctp501=https://192.168.10.41:2380,devk8sctp502=https://192.168.10.42:2380,devk8sctp503=https://192.168.10.43:2380 \
snapshot restore $SNAPSHOT_FILE_NAME
  
